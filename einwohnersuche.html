<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einwohnersuche</title>
    <style>
      
        body {
            font-family: Arial, sans-serif;
            background-color: #2b2f3a;
            color: white;
            margin: 0;
            padding: 0;
        }

        .delete-icon {
    width: 30px; 
    height: 30px;
    cursor: pointer;
    margin-left: 10px; 
    position: relative;
    top: 10px; 
}


 .details-card h3 {
        background-color: #3a3f4d;
        padding: 10px;
        border-radius: 5px;
        color: rgb(175, 168, 168);
    }

   
    .details-card.notes h3 {
        background-color: #3a3f4d;
        padding: 10px;
        border-radius: 5px;
        color: rgb(175, 168, 168);
    }


    /* Stift-Bild */
    .edit-icon {
        width: 30px;
        height: 30px;
        cursor: pointer;
        margin-left: 10px;
        position: relative;
        top: 10px;
    }

        .dashboard {
            display: flex;
        }

        .dashboard-header h1 {
            font-size: 24px;
            margin: 0;
        }

        .sidebar {
            width: 80px;
            background-color: #1c1f26;
            padding: 20px 0;
            height: 100vh;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .menu-item img {
            width: 40px;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .content {
            flex: 1;
            padding: 20px;
        }

        .dashboard-header {
            border-bottom: 1px solid #444;
            padding: 10px 0;
        }

        .search {
            margin-top: 30px;
        }

        .search-bar-container {
            display: flex;
            align-items: center;
            background-color: #1e222b;
            border-radius: 5px;
            border: 1px solid #444;
            padding: 5px 10px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-bar-container img {
            width: 20px;
            margin-right: 10px;
        }

        .search-bar {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: none;
            background: none;
            color: white;
        }

        .search-bar:focus {
            outline: none;
        }

        .suggestion-list {
            margin-top: 10px;
            max-width: 600px;
            margin: 10px auto 0;
            background-color: #1e222b;
            border: 1px solid #444;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #444;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background-color: #444;
        }

        .details-container {
    display: none;
    padding: 20px;
    background-color: #1e222b;
    border-radius: 8px;
    border: 1px solid #444;
    margin-top: 50px; 
}

        .details-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-button {
            background-color: transparent;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin-right: 20px;
        }

        .details-header h2 {
            margin: 0;
        }

        .details-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .details-card {
            background-color: #2b2f3a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
        }

        .details-card h3 {
            margin: 0 0 10px 0;
        }

        .details-card p {
            margin: 5px 0;
        }

        .notes {
            grid-column: span 3;
        }

        .add-button {
            cursor: pointer;
            color: rgb(29, 29, 29);
            font-size: 24px;
            font-weight: bold;
            background: none;
            border: none;
        }

        .hidden {
            display: none;
        }

        .input-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .input-container input {
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }
        #license-input, #note-input, #criminal-record-input {
    background-color: #2b2f3a; 
    color: white; 
    border: 1px solid #444; 
    border-radius: 5px; 
    padding: 8px; 
    font-size: 16px; 
}

#save-license, #save-note, #save-criminal-record {
    background-color: rgb(13, 98, 226);
    color: white; 
    border: 1px solid rgb(13, 98, 226);
    border-radius: 5px;
    padding: 8px; 
    cursor: pointer; 
}

#save-license:hover, #save-note:hover #save-criminal-record:hover {
    background-color: rgb(13, 98, 226);
}

        .input-container button {
            padding: 8px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
  <div class="dashboard">

        <aside class="sidebar">
            <nav class="sidebar-menu">
                <a href="dashboard.html" class="menu-item">
                    <img src="https://cdn.discordapp.com/attachments/1306339918645166100/1314588485071667261/crvt.co-star-solid.png?ex=675f862e&is=675e34ae&hm=76b45916f5bf351e3c87dcbc6b2922b43c1f4b5f5144ea3bfaaaeb65da60e4a2&" alt="Icon">
                </a>
                <a href="einwohnersuche.html" class="menu-item">
                    <img src="https://cdn.discordapp.com/attachments/1306339918645166100/1314588485503553636/crvt.co-bxs-user.png?ex=675f862e&is=675e34ae&hm=f70ff47830a2ad68395428d1539766d09cc8953b516c4d107c9f057a936f0025&" alt="Icon">
                </a>
                <a href="fahrzeugsuche.html" class="menu-item">
                    <img src="https://cdn.discordapp.com/attachments/1306339918645166100/1314588485298028554/crvt.co-bxs-truck.png?ex=675f862e&is=675e34ae&hm=a986508fd4b10cf4957988437650a732bfe6761752fff513df1d1c1efe3402cf&" alt="Icon">
                </a>
                <a href="einstellungen.html" class="menu-item">
                    <img src="https://cdn.discordapp.com/attachments/1306339918645166100/1314588484840853524/crvt.co-cog-8-tooth-20-solid.png?ex=675f862e&is=675e34ae&hm=dcc4f2cfa5a27046fb1f1e5af858da1eecc0936cb39dfb0df3ed932e45c01345&" alt="Icon">
                </a>

            </nav>
        </aside>

        
        <div class="content">
            <header class="dashboard-header">
                <h1>Einwohner | Suche</h1>
            </header>
            <section id="search-container" class="search">
                <div class="search-bar-container">
                    <img src="https://cdn.discordapp.com/attachments/1193016571115876393/1314593442407383100/crvt.co-search-alt-2.png?ex=675f8acc&is=675e394c&hm=4b8c723bf3cf71d0781774d335d4212b0eb7aa389361e8ba9785b88b9dc7c997&" alt="Search Icon">
                    <input type="text" id="search-bar" class="search-bar" placeholder="Einwohnersuche">
                </div>
                <div id="suggestion-list" class="suggestion-list"></div>
            </section>

            <section id="details-container" class="details-container">
                <div class="details-header">
                    <button class="back-button" id="back-button">←</button>
                    <h2>Benutzerinformationen</h2>
                </div>
                <div class="details-content">
                    <div class="details-card">
                        <h3>Personeninformationen</h3>
                        <p id="user-name"></p>
                        <p id="user-birth"></p>
                        <p id="user-gender"></p>
                    </div>
                    <div class="details-card">
                        <h3>Lizenzen <button class="add-button" id="add-license"></button></h3>
                        <ul id="user-licenses"></ul>
                        <div id="license-input-container" class="input-container hidden">
                            <input type="text" id="license-input" placeholder="Neue Lizenz hinzufügen">
                            <button id="save-license">Speichern</button>
                        </div>
                    </div>
                    <div class="details-card">
                        <h3>Kontaktdaten</h3>
                        <p id="user-contact"></p>
                    </div>
                    <div class="details-card notes">
                        <h3>Notizen <button class="add-button" id="add-note">+</button></h3>
                        <ul id="user-notes"></ul>
                        <div id="note-input-container" class="input-container hidden">
                            <input type="text" id="note-input" placeholder="Neue Notiz hinzufügen">
                            <button id="save-note">Speichern</button>
                        </div>
                    </div>
                    <div class="details-card">
                        <h3>Strafregister <button class="add-button" id="add-criminal-record"></button></h3>
                        <ul id="user-criminal-records"></ul>
                        <div id="criminal-record-input-container" class="input-container hidden">
                            <input type="text" id="criminal-record-input" placeholder="Neues Vergehen hinzufügen">
                            <button id="save-criminal-record">Speichern</button>
                        </div>
                    </div>
            </section>
        </div>
    </div>

    <script>
        const searchContainer = document.getElementById("search-container");
const detailsContainer = document.getElementById("details-container");
const searchBar = document.getElementById("search-bar");
const suggestionList = document.getElementById("suggestion-list");

const licenseInputContainer = document.getElementById("license-input-container");
const licenseInput = document.getElementById("license-input");
const saveLicenseButton = document.getElementById("save-license");
const licenseList = document.getElementById("user-licenses");

const criminalRecordInputContainer = document.getElementById("criminal-record-input-container");
const criminalRecordInput = document.getElementById("criminal-record-input");
const saveCriminalRecordButton = document.getElementById("save-criminal-record");
const criminalRecordList = document.getElementById("user-criminal-records");

const noteInputContainer = document.getElementById("note-input-container");
const noteInput = document.getElementById("note-input");
const saveNoteButton = document.getElementById("save-note");
const noteList = document.getElementById("user-notes");

let users = [];
let currentUser = null;

// Benutzer laden
fetch("/users")
    .then(response => response.json())
    .then(data => {
        users = data;
        console.log("Benutzerdaten geladen:", users);
    })
    .catch(error => console.error("Fehler beim Laden der Benutzerdaten:", error));

// Suche und Vorschläge
searchBar.addEventListener("input", () => {
    const query = searchBar.value.toLowerCase();
    suggestionList.innerHTML = "";

    if (query) {
        const filteredUsers = users.filter(user =>
            user.vorname.toLowerCase().includes(query) ||
            user.nachname.toLowerCase().includes(query)
        );

        filteredUsers.forEach(user => {
            const listItem = document.createElement("div");
            listItem.className = "suggestion-item";
            listItem.textContent = `${user.vorname} ${user.nachname}`;
            suggestionList.appendChild(listItem);

            listItem.addEventListener("click", () => {
                showDetails(user);
            });
        });
    }
});

// Benutzer-Details anzeigen
function showDetails(user) {
    currentUser = user;

    document.getElementById("user-name").textContent = `Name: ${user.vorname} ${user.nachname}`;
    document.getElementById("user-birth").textContent = `Geburtsdatum: ${user.geburtsdatum}`;
    document.getElementById("user-gender").textContent = `Geschlecht: ${user.geschlecht}`;
    document.getElementById("user-contact").textContent = `Kontakt: ${user.email}, ${user.telefonnummer}`;

    renderList(user.lizenzen, licenseList, "Lizenz");
    renderList(user.strafen, criminalRecordList, "Strafe");
    renderList(user.notizen, noteList, "Notiz");

    searchContainer.style.display = "none";
    detailsContainer.style.display = "block";
}

// Liste rendern
function renderList(items, listElement, type) {
    listElement.innerHTML = "";

    items.forEach((item, index) => {
        const listItem = document.createElement("li");
        listItem.textContent = item;

        const deleteIcon = document.createElement("button");
        deleteIcon.textContent = "❌";
        deleteIcon.addEventListener("click", () => {
            items.splice(index, 1);
            saveUserData(currentUser, `Element aus ${type} entfernt`);
        });

        listItem.appendChild(deleteIcon);
        listElement.appendChild(listItem);
    });
}

// Lizenz hinzufügen
saveLicenseButton.addEventListener("click", () => {
    const newLicense = licenseInput.value.trim();
    if (newLicense && currentUser) {
        currentUser.lizenzen.push(newLicense);
        saveUserData(currentUser, "Neue Lizenz hinzugefügt");
        licenseInput.value = "";
    }
});

// Strafe hinzufügen
saveCriminalRecordButton.addEventListener("click", () => {
    const newCriminalRecord = criminalRecordInput.value.trim();
    if (newCriminalRecord && currentUser) {
        currentUser.strafen.push(newCriminalRecord);
        saveUserData(currentUser, "Neue Strafe hinzugefügt");
        criminalRecordInput.value = "";
    }
});

// Notiz hinzufügen
saveNoteButton.addEventListener("click", () => {
    const newNote = noteInput.value.trim();
    if (newNote && currentUser) {
        currentUser.notizen.push(newNote);
        saveUserData(currentUser, "Neue Notiz hinzugefügt");
        noteInput.value = "";
    }
});

// Benutzer speichern
function saveUserData(user, successMessage) {
    fetch("/save-user", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(user)
    })
        .then(response => response.text())
        .then(message => {
            console.log(message);
            alert(successMessage || "Daten erfolgreich gespeichert");
            showDetails(user);
        })
        .catch(error => console.error("Fehler beim Speichern:", error));
}

// Zurück zur Suche
document.getElementById("back-button").addEventListener("click", () => {
    detailsContainer.style.display = "none";
    searchContainer.style.display = "block";
});

     </script>
      
</body>
</html>
